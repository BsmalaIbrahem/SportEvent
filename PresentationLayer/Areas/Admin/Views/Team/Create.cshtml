@model PresentationLayer.ViewModels.CreateTeamVM

<style>
    .select2-container--default .select2-selection--single .select2-selection__rendered {
        color: #444;
        line-height: 14px;
    }
</style>

<h3 class="container mt-3">Create New Team</h3>

<div class="container mt-3">
    <form asp-action="Create" method="post" enctype="multipart/form-data">
        <div class="form-group mb-12">
            <label asp-for="Name" class="form-label">Team Name</label>
            <input asp-for="Name" class="form-control" required />
            <span asp-validation-for="Name" class="text-danger"></span>
        </div>

        <div class="form-group mb-3">
            <label asp-for="Description" class="form-label">Description</label>
            <textarea asp-for="Description" class="form-control"></textarea>
            <span asp-validation-for="Description" class="text-danger"></span>
        </div>

        <div class="form-group mb-3">
            <label asp-for="LogoUrl" class="form-label">Team Logo</label>
            <input type="file" name="LogoUrl" class="form-control" accept="image/*" required />
            <span asp-validation-for="LogoUrl" class="text-danger"></span>
        </div>

        <div class="form-group mb-3">
            <label asp-for="Country" class="form-label">Country</label>
            <input asp-for="Country" class="form-control" required />
            <span asp-validation-for="Country" class="text-danger"></span>
        </div>

        <div class="form-group mb-3">
            <label asp-for="Founded" class="form-label">Founded Date</label>
            <input asp-for="Founded" type="date" class="form-control" required />
            <span asp-validation-for="Founded" class="text-danger"></span>
        </div>

        <div class="form-group mb-3 text-bg-success">
            <label asp-for="CoachesId" class="form-label">Coach</label>
            <select asp-for="CoachesId" asp-items="@Model.Coaches" style="width:100%; line-height:14px;" class="js-example-basic-single form-control" required>
                <option value="">Select a Coach</option>
            </select>
            <span asp-validation-for="CoachesId" class="text-danger"></span>
        </div>

        <div class="form-group mb-3">
            <label class="form-label">Players</label>
            <select id="playerSelect" style="width:100%; line-height:14px;" class="js-example-basic-single form-control" multiple>
                @foreach (var player in Model.AvailablePlayers)
                {
                    <option value="@player.Value">@player.Text</option>
                }
            </select>
            <button type="button" id="addPlayer" class="btn btn-secondary mt-2">Add Player</button>
            <div id="selectedPlayers" class="mt-3"></div>
            <span class="text-danger" id="playersError"></span>
        </div>

        <div class="form-group mb-3">
            <label asp-for="CaptainId" class="form-label">Captain</label>
            <select asp-for="CaptainId" style="width:100%; line-height:14px;" id="captainSelect" class="js-example-basic-single form-control" required>
                <option value="">Select a Captain</option>
            </select>
            <span asp-validation-for="CaptainId" class="text-danger"></span>
        </div>

        <button type="submit" class="btn btn-primary">Create</button>
    </form>
</div>


@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        $(document).ready(function () {
            $('#playerSelect').select2({
                placeholder: "Select players",
                allowClear: true
            });

            let playerIndex = 0;
            let captainOptions = '<option value="">Select a Captain</option>';

            $('#addPlayer').click(function () {
                const selectedOptions = $('#playerSelect').val();
                if (!selectedOptions || selectedOptions.length === 0) {
                    $('#playersError').text('Please select at least one player.');
                    return;
                }
                $('#playersError').text('');

                selectedOptions.forEach(function (playerId) {
                    const playerText = $('#playerSelect option[value="' + playerId + '"]').text();
                    const html = `
                        <div class="player-selection mb-3" data-player-id="${playerId}">
                            <input type="hidden" name="SelectedPlayers[${playerIndex}].PlayerId" value="${playerId}" />
                            <label>Player: ${playerText}</label>
                            <div class="form-group">
                                <label>Joined Date</label>
                                <input type="date" name="SelectedPlayers[${playerIndex}].JoinedDate" class="form-control" required />
                            </div>
                            <div class="form-group">
                                <label>Number</label>
                                <input type="number" name="SelectedPlayers[${playerIndex}].Number" class="form-control" min="1" max="99" />
                            </div>
                            <button type="button" class="btn btn-danger remove-player">Remove</button>
                        </div>`;
                    $('#selectedPlayers').append(html);
                    captainOptions += `<option value="${playerId}">${playerText}</option>`;
                    playerIndex++;
                });
                $('#captainSelect').html(captainOptions);
                $('#playerSelect').val(null).trigger('change');
            });

            $(document).on('click', '.remove-player', function () {
                const playerId = $(this).closest('.player-selection').data('player-id');
                $(this).closest('.player-selection').remove();
                $(`#captainSelect option[value="${playerId}"]`).remove();
                if ($('#captainSelect').val() === playerId) {
                    $('#captainSelect').val('');
                }
            });

            // تحقق من وجود لاعبين قبل الإرسال
            $('form').submit(function (e) {
                if ($('.player-selection').length === 0) {
                    e.preventDefault();
                    $('#playersError').text('At least one player is required.');
                }
            });
        });
    </script>
}