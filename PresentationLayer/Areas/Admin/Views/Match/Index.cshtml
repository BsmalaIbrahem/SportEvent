@using CoreLayer.Enums
@using CoreLayer.Helpers
@model ModelsWithPaginationVM<Match>

<style>
    select.form-control, select.asColorPicker-input, .dataTables_wrapper select, .jsgrid .jsgrid-table .jsgrid-filter-row select, .select2-container--default select.select2-selection--single, .select2-container--default .select2-selection--single select.select2-search__field, select.typeahead, select.tt-query, select.tt-hint {
        padding: .4375rem .75rem;
        border: 0;
        color: #c4cbd5;
    }
</style>
<div style="text-align:right; margin-top:30px; margin-right:20px;">
    <a asp-action="Create" class="btn btn-primary">Create</a>
</div>

<div class="col-lg-12 grid-margin stretch-card">
    <div class="card">
        <div class="card-body">
            <h4 class="card-title">Matches</h4>

            <!-- Filters -->
            <form asp-action="Index" method="get" class="mb-3">
                <div class="d-flex flex-wrap justify-content-between align-items-center gap-2">

                    <!-- Page Size -->
                    <button class="btn  dropdown-toggle" style="border: 1px solid #444;" type="button" id="dropdownMenuButton2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        @( Model.Pagination.PageSize != 0 ?  Model.Pagination.PageSize: "Page Size")
                    </button>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton2">
                        @{
                            int[] PageSizes = new int[] { 5, 10, 15, 20 };
                        }
                        @for (var j = 0; j < PageSizes.Length; j++)
                        {
                            <a class="dropdown-item" href="@Url.Action("Index", new { PageSize = PageSizes[j], status = ViewBag.Status, IsToday = (ViewBag.IsToday == "true" ? true : false) })">@PageSizes[j]</a>
                        }
                    </div>

                    <div class="d-flex flex-wrap justify-content-between align-items-center gap-2">
                        <select class="form-control w-auto" name="status" style="margin-right: 10px;">
                            <option style="color:#c4cbd5" value="">-- Status --</option>
                            @foreach (var st in Enum.GetValues(typeof(MatchStatus)))
                            {
                                if (ViewBag.Status == st.ToString())
                                {
                                    <option style="color:#c4cbd5" value="@st" selected>@st</option>
                                }
                                else
                                {
                                    <option style="color:white;" value="@st">@st</option>
                                }

                            }
                        </select>

                        <!-- IsToday -->
                        <div class="form-check form-switch ms-2" style="margin-right: 10px;">
                            <input type="checkbox" class="form-check-input" name="IsToday" value="true"
                                   @(ViewBag.IsToday == "true" ? "checked" : "") />
                            <label class="">Today</label>
                        </div>

                        <!-- Submit Button -->
                        <button type="submit" class="btn btn-filter" style="display:flex; align-items:center; color:white; border: 2px solid #198754; background-color:#1b6e48">
                            <i class="mdi mdi-filter-variant" style="font-size:25px"></i>
                            <span>Filter</span>
                        </button>
                    </div>

                    <!-- Status Filter -->
                   
                </div>
            </form>

            <!-- Table -->
            <div class="table-responsive">
                <table class="table table-dark">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Home Team</th>
                            <th>Away Team</th>
                            <th>Tournament</th>
                            <th>Status</th>
                            <th>Date Time</th>
                            <th>Available Tickets</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.Items)
                        {
                            <tr>
                                <td><strong>@item.Id</strong></td>
                                <td>@item.HomeTeam.Name (Score : @item.HomeScore)</td>
                                <td>@item.AwayTeam.Name (Score : @item.AwayScore)</td>
                                <td>@item.Tournament.Title.GetDisplayName()</td>
                                <td>@item.Status</td>
                                <td>@item.MatchDate</td>
                                <td>@item.AvailableTickets</td>
                                <td>
                                    <div>
                                        <a asp-action="Edit" asp-route-id="@item.Id" class="btn p-0">
                                            <i class="mdi mdi-lead-pencil"></i>
                                        </a>
                                        <a href="javascript:void(0);"
                                           class="btn p-0"
                                           data-bs-toggle="modal"
                                           data-bs-target="#archiveModal"
                                           data-id="@item.Id">
                                            <i class="mdi mdi-archive"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            @if (Model.Pagination.TotalPages > 1)
            {
                <div class="w-100 d-flex justify-content-center mt-2 mb-3">
                    <nav aria-label="Page navigation">
                        <ul class="pagination">
                            @{
                                var currentPage = Model.Pagination.PageNumber;
                                var pageSize = Model.Pagination.PageSize;
                                var totalPages = Model.Pagination.TotalPages;
                                var maxPagesToShow = 5;

                                var startPage = Math.Max(1, currentPage - maxPagesToShow / 2);
                                var endPage = Math.Min(totalPages, startPage + maxPagesToShow - 1);

                                if (endPage - startPage < maxPagesToShow - 1)
                                {
                                    startPage = Math.Max(1, endPage - maxPagesToShow + 1);
                                }
                            }

                            @if (Model.Pagination.HasPreviousPage)
                            {
                                <li class="page-item">
                                    <a class="page-link" href="@Url.Action("Index", new { PageNumber = currentPage - 1, PageSize = pageSize, status = ViewBag.Status, IsToday = (ViewBag.IsToday == "true" ? true : false) })">
                                        &laquo;
                                    </a>
                                </li>
                            }

                            @if (startPage > 1)
                            {
                                <li class="page-item">
                                    <a class="page-link" href="@Url.Action("Index", new { PageNumber = 1, PageSize = pageSize, status = ViewBag.Status, IsToday = (ViewBag.IsToday == "true" ? true : false) })">1</a>
                                </li>
                                @if (startPage > 2)
                                {
                                    <li class="page-item disabled"><span class="page-link">...</span></li>
                                }
                            }

                            @for (var i = startPage; i <= endPage; i++)
                            {
                                <li class="page-item @(currentPage == i ? "active" : "")">
                                    <a class="page-link" href="@Url.Action("Index", new { PageNumber = i, PageSize = pageSize, status = ViewBag.Status, IsToday = (ViewBag.IsToday == "true" ? true : false) })">@i</a>
                                </li>
                            }

                            @if (endPage < totalPages)
                            {
                                @if (endPage < totalPages - 1)
                                {
                                    <li class="page-item disabled"><span class="page-link">...</span></li>
                                }
                                <li class="page-item">
                                    <a class="page-link" href="@Url.Action("Index", new { PageNumber = totalPages, PageSize = pageSize, status = ViewBag.Status, IsToday = (ViewBag.IsToday == "true" ? true : false) })">@totalPages</a>
                                </li>
                            }

                            @if (Model.Pagination.HasNextPage)
                            {
                                <li class="page-item">
                                    <a class="page-link" href="@Url.Action("Index", new { PageNumber = currentPage + 1, PageSize = pageSize, status = ViewBag.Status, IsToday = (ViewBag.IsToday == "true" ? true : false) })">
                                        &raquo;
                                    </a>
                                </li>
                            }
                        </ul>
                    </nav>
                </div>

            }


           
        </div>
    </div>
</div>


